---
import Sparkles from '@lucide/astro/icons/sparkles';
import Moon from '@lucide/astro/icons/moon';
---

<button id="themeToggle">
  <Sparkles class="sun" size="36"/>
  <Moon class="moon" size="36"/>
</button>

<script is:inline>
  const htmlElement = document.documentElement;

  window.toggleTheme = function() {
    htmlElement.classList.toggle("dark");
    const isDark = htmlElement.classList.contains("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
  };

  const initialTheme = (() => {
    const localStorageTheme = localStorage?.getItem("theme") ?? "";
    if (["dark", "light"].includes(localStorageTheme)) {
      return localStorageTheme;
    }
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      return "dark";
    }
    return "light";
  })();

  if (initialTheme === "light") {
    htmlElement.classList.remove("dark");
  } else {
    htmlElement.classList.add("dark");
  }

  window.localStorage.setItem("theme", initialTheme);

  document
    .getElementById("themeToggle")
    ?.addEventListener("click", window.toggleTheme);
</script>
